<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="edibble">
<title>Defining structure • edibble</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Defining structure">
<meta property="og:description" content="edibble">
<meta property="og:image" content="https://edibble.emitanaka.org/logo.png">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:creator" content="@statsgen">
<meta name="twitter:site" content="@statsgen">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=G-7HJYKJBM5E"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-7HJYKJBM5E');
</script>
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-dark navbar-expand-lg bg-primary"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">edibble</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.1.0.9000</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/defining-structure.html">Defining structure</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/emitanaka/edibble/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">



<script src="defining-structure_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Defining structure</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/emitanaka/edibble/blob/HEAD/vignettes/defining-structure.Rmd" class="external-link"><code>vignettes/defining-structure.Rmd</code></a></small>
      <div class="d-none name"><code>defining-structure.Rmd</code></div>
    </div>

    
    
<p>In this vignette, we assume that the experimental aim is to find the best wheat variety from a wheat field trial.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://edibble.emitanaka.org/">edibble</a></span><span class="op">)</span></span></code></pre></div>
<div class="section level2">
<h2 id="initialisation">Initialisation<a class="anchor" aria-label="anchor" href="#initialisation"></a>
</h2>
<p>A new design constructed using edibble must start by initialising the <em>design object</em>. An optional title of the design may be provided as input. This information persists as metadata in the object and is displayed in various places (e.g., print output and exported files).</p>
<p>When you have no data, you start by simply initialising the design object.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/design.html">design</a></span><span class="op">(</span><span class="st">"Wheat field trial"</span><span class="op">)</span></span></code></pre></div>
<p>At this point, there is nothing particularly interesting. The design object requires the user to define the experimental factor(s) as described next.</p>
</div>
<div class="section level2">
<h2 id="units">Units<a class="anchor" aria-label="anchor" href="#units"></a>
</h2>
<p>At minimum, the design requires units to be defined via <code>set_units</code>. In the code below, we initialise a new design object and then set a unit called “site” with 4 levels. The left hand side (LHS) and the right hand side (RHS) of the function input correspond to the factor name and the corresponding value, respectively. Here, the value is a single integer that denotes the number of levels of the factor. Note that the <em>LHS can be any arbitrary (preferably syntactically valid) name</em>. Selecting a name that succinctly describes the factor is recommended. Acronyms should be avoided where reasonable. We assign this design object to the variable called <code>demo</code>.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">demo</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/design.html">design</a></span><span class="op">(</span><span class="st">"Demo for defining units"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="../reference/set_units.html">set_units</a></span><span class="op">(</span>site <span class="op">=</span> <span class="fl">4</span><span class="op">)</span></span></code></pre></div>
<p>At this point, the design is in a <em>graph form</em>. The print of this object shows a prettified tree that displays the title of the experiment, the factors, and their corresponding number of levels. Notice the root in this tree output corresponds to the title given in the object initialisation.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">demo</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB; font-style: italic;">Demo for defining units</span></span></span>
<span><span class="co">#&gt; └─<span style="color: #BBBB00; background-color: #000000;">site</span> <span style="color: #555555;">(4 levels)</span></span></span></code></pre></div>
<p>To obtain the <em>design table</em>, you must call on <code>serve_table</code> to signal that you wish the object to be transformed into the <em>tabular form</em>. The transformation for <code>demo</code> is shown below, where the output is a type of <code>tibble</code> with one column (the “site” factor), four rows (corresponding to the four levels in the site), and the entries corresponding to the actual levels of the factor (name derived as “site1”, “site2”, “site3”, and “site4” here). The first line of the print output is decorated with the title of the design object, which acts as a persistent reminder of the initial input. The row just under the header shows the role of the factor denoted by the upper case letter (here, U = unit) with the number of levels in that factor displayed. If the number of levels exceed a thousand, then the number is shown with an SI prefix rounded to the closest digit corresponding to the SI prefix form (e.g., 1000 is shown as 1k and 1800 is shown as ~2k). The row that follows shows the class of the factor (e.g., character or numeric).</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/serve_table.html">serve_table</a></span><span class="op">(</span><span class="va">demo</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># </span><span style="color: #949494; font-weight: bold;">Demo for defining units</span> </span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># An edibble: 4 x 1</span></span></span>
<span><span class="co">#&gt;     site</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;U(4)&gt;</span></span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span>  site1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span>  site2</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span>  site3</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span>  site4</span></span></code></pre></div>
<p>If particular names are desired for the levels, then the RHS value can be replaced with a vector like below where the levels are named “Narrabri”, “Horsham”, “Parkes” and “Roseworthy”.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/design.html">design</a></span><span class="op">(</span><span class="st">"Character vector input demo"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="../reference/set_units.html">set_units</a></span><span class="op">(</span>site <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Narrabri"</span>, <span class="st">"Horsham"</span>, <span class="st">"Parkes"</span>, <span class="st">"Roseworthy"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="../reference/serve_table.html">serve_table</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># </span><span style="color: #949494; font-weight: bold;">Character vector input demo</span> </span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># An edibble: 4 x 1</span></span></span>
<span><span class="co">#&gt;         site</span></span>
<span><span class="co">#&gt;       <span style="color: #949494; font-style: italic;">&lt;U(4)&gt;</span></span></span>
<span><span class="co">#&gt;        <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> Narrabri  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> Horsham   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> Parkes    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> Roseworthy</span></span></code></pre></div>
<p>The RHS value in theory be any vector. Below the input is a numeric vector, and the corresponding output will be a <code>data.frame</code> with a numeric column.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/design.html">design</a></span><span class="op">(</span><span class="st">"Numeric vector input demo"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="../reference/set_units.html">set_units</a></span><span class="op">(</span>site <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">3</span>, <span class="fl">4</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="../reference/serve_table.html">serve_table</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># </span><span style="color: #949494; font-weight: bold;">Numeric vector input demo</span> </span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># An edibble: 4 x 1</span></span></span>
<span><span class="co">#&gt;     site</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;U(4)&gt;</span></span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span>      1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span>      2</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span>      3</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span>      4</span></span></code></pre></div>
<p>In the instance that you do want to enter a single level with a numeric value, this can be specified using <code>lvls</code> on the RHS.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/design.html">design</a></span><span class="op">(</span><span class="st">"Single numeric level demo"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="../reference/set_units.html">set_units</a></span><span class="op">(</span>site <span class="op">=</span> <span class="fu"><a href="../reference/lvls.html">lvls</a></span><span class="op">(</span><span class="fl">4</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="../reference/serve_table.html">serve_table</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># </span><span style="color: #949494; font-weight: bold;">Single numeric level demo</span> </span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># An edibble: 1 x 1</span></span></span>
<span><span class="co">#&gt;     site</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;U(1)&gt;</span></span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span>      4</span></span></code></pre></div>
<div class="section level3">
<h3 id="multiple-units">Multiple units<a class="anchor" aria-label="anchor" href="#multiple-units"></a>
</h3>
<p>We can add more unit factors to this study. Suppose that we have 72 plots. We append another call to <code>set_units</code> to encode this information.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">demo2</span> <span class="op">&lt;-</span> <span class="va">demo</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="../reference/set_units.html">set_units</a></span><span class="op">(</span>plot <span class="op">=</span> <span class="fl">72</span><span class="op">)</span></span></code></pre></div>
<p>However, we did not defined the relationship between <code>site</code> and <code>plot</code>; so it fails to convert to the tabular form.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/serve_table.html">serve_table</a></span><span class="op">(</span><span class="va">demo2</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #BBBB00; font-weight: bold;">Error</span><span style="font-weight: bold;"> in `serve_table()`:</span></span></span>
<span><span class="co">#&gt; <span style="color: #BBBB00;">!</span> The graph cannot be converted to a table format.</span></span></code></pre></div>
<p>The relationship between unit factors can be defined concurrently when defining the unit factors using helper functions. One of these helper functions is demonstrated next.</p>
</div>
<div class="section level3">
<h3 id="sec-nested">Nested units<a class="anchor" aria-label="anchor" href="#sec-nested"></a>
</h3>
<p>Given that we have a wheat trial, we imagine that the site corresponds to the locations, and each location would have its own plots. The experimenter tells you that each site contains 18 plots. This nesting structure can be defined by using the helper function <code>nested_in</code>. With this relationship specified, the graph can be reconciled into a tabular format, as shown below.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">demo</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="../reference/set_units.html">set_units</a></span><span class="op">(</span>plot <span class="op">=</span> <span class="fu"><a href="../reference/nested_in.html">nested_in</a></span><span class="op">(</span><span class="va">site</span>, <span class="fl">18</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="../reference/serve_table.html">serve_table</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># </span><span style="color: #949494; font-weight: bold;">Demo for defining units</span> </span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># An edibble: 72 x 2</span></span></span>
<span><span class="co">#&gt;      site    plot</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;U(4)&gt;</span> <span style="color: #949494; font-style: italic;">&lt;U(72)&gt;</span></span></span>
<span><span class="co">#&gt;     <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span>  site1  plot01</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span>  site1  plot02</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span>  site1  plot03</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span>  site1  plot04</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span>  site1  plot05</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span>  site1  plot06</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span>  site1  plot07</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span>  site1  plot08</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span>  site1  plot09</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span>  site1  plot10</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 62 more rows</span></span></span></code></pre></div>
<p>In the above situation, the relationship between unit factors have to be apriori known, but there are situations in which the relationship may become cognizant only after defining the unit factors. In these situations, users can define the relationships using the functions <code>allot_units</code> and <code>assign_units</code> to add the edges between the relevant unit nodes in the factor and level graphs, respectively.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">demo2</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="../reference/allot_units.html">allot_units</a></span><span class="op">(</span><span class="va">site</span> <span class="op">~</span> <span class="va">plot</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="../reference/assign_fcts.html">assign_units</a></span><span class="op">(</span>order <span class="op">=</span> <span class="st">"systematic-fastest"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="../reference/serve_table.html">serve_table</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># </span><span style="color: #949494; font-weight: bold;">Demo for defining units</span> </span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># An edibble: 72 x 2</span></span></span>
<span><span class="co">#&gt;      site    plot</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;U(4)&gt;</span> <span style="color: #949494; font-style: italic;">&lt;U(72)&gt;</span></span></span>
<span><span class="co">#&gt;     <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span>  site1  plot01</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span>  site2  plot02</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span>  site3  plot03</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span>  site4  plot04</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span>  site1  plot05</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span>  site2  plot06</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span>  site3  plot07</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span>  site4  plot08</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span>  site1  plot09</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span>  site2  plot10</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 62 more rows</span></span></span></code></pre></div>
<p>The code above specifies the nested relationship of <code>plot</code> to <code>site</code>, with the assignment of levels performed systematically. The systematic allocation of <code>site</code> levels to <code>plot</code> is done so that the <code>site</code> levels vary the fastest, which is not the same systematic ordering as before. If the same result as before is desirable, users can define <code>order = "systematic-slowest"</code>, which offers a systematic assignment where the same levels are close together.</p>
</div>
<div class="section level3">
<h3 id="sec-crossed">Crossed units<a class="anchor" aria-label="anchor" href="#sec-crossed"></a>
</h3>
<p>Crop field trials are often laid out in rectangular arrays. The experimenter confirms this by alerting to us that each site has plots laid out in a rectangular array with 6 rows and 3 columns. We can define crossing structures using <code>crossed_by</code>.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/design.html">design</a></span><span class="op">(</span><span class="st">"Crossed experiment"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="../reference/set_units.html">set_units</a></span><span class="op">(</span>row <span class="op">=</span> <span class="fl">6</span>,</span>
<span>            col <span class="op">=</span> <span class="fl">3</span>,</span>
<span>            plot <span class="op">=</span> <span class="fu"><a href="../reference/crossed_by.html">crossed_by</a></span><span class="op">(</span><span class="va">row</span>, <span class="va">col</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="../reference/serve_table.html">serve_table</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># </span><span style="color: #949494; font-weight: bold;">Crossed experiment</span> </span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># An edibble: 18 x 3</span></span></span>
<span><span class="co">#&gt;       row    col    plot</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;U(6)&gt;</span> <span style="color: #949494; font-style: italic;">&lt;U(3)&gt;</span> <span style="color: #949494; font-style: italic;">&lt;U(18)&gt;</span></span></span>
<span><span class="co">#&gt;     <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span>   row1   col1  plot01</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span>   row2   col1  plot02</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span>   row3   col1  plot03</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span>   row4   col1  plot04</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span>   row5   col1  plot05</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span>   row6   col1  plot06</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span>   row1   col2  plot07</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span>   row2   col2  plot08</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span>   row3   col2  plot09</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span>   row4   col2  plot10</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">11</span>   row5   col2  plot11</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">12</span>   row6   col2  plot12</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">13</span>   row1   col3  plot13</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">14</span>   row2   col3  plot14</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">15</span>   row3   col3  plot15</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">16</span>   row4   col3  plot16</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">17</span>   row5   col3  plot17</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">18</span>   row6   col3  plot18</span></span></code></pre></div>
<p>The above table does not contain information on the site. For this, we need to combine the nesting and crossing structures, as shown next.</p>
</div>
<div class="section level3">
<h3 id="complex-unit-structures">Complex unit structures<a class="anchor" aria-label="anchor" href="#complex-unit-structures"></a>
</h3>
<p>Now, suppose that there are four sites (Narrabri, Horsham, Parkes, and Roseworthy), and the 18 plots at each site are laid out in a rectangular array of 3 rows and 6 columns. We begin by specifying the site (the highest hierarchy in this structure). The dimensions of the rows and columns are specified for each site (3 rows and 6 columns). The plot is a result of crossing the row and column within each site.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">complex</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/design.html">design</a></span><span class="op">(</span><span class="st">"Complex structure"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="../reference/set_units.html">set_units</a></span><span class="op">(</span>site <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Narrabri"</span>, <span class="st">"Horsham"</span>, <span class="st">"Parkes"</span>, <span class="st">"Roseworthy"</span><span class="op">)</span>,</span>
<span>            col <span class="op">=</span> <span class="fu"><a href="../reference/nested_in.html">nested_in</a></span><span class="op">(</span><span class="va">site</span>, <span class="fl">6</span><span class="op">)</span>,</span>
<span>            row <span class="op">=</span> <span class="fu"><a href="../reference/nested_in.html">nested_in</a></span><span class="op">(</span><span class="va">site</span>, <span class="fl">3</span><span class="op">)</span>,</span>
<span>            plot <span class="op">=</span> <span class="fu"><a href="../reference/nested_in.html">nested_in</a></span><span class="op">(</span><span class="va">site</span>, <span class="fu"><a href="../reference/crossed_by.html">crossed_by</a></span><span class="op">(</span><span class="va">row</span>, <span class="va">col</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> </span>
<span></span>
<span><span class="fu"><a href="../reference/serve_table.html">serve_table</a></span><span class="op">(</span><span class="va">complex</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># </span><span style="color: #949494; font-weight: bold;">Complex structure</span> </span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># An edibble: 72 x 4</span></span></span>
<span><span class="co">#&gt;        site     col     row    plot</span></span>
<span><span class="co">#&gt;      <span style="color: #949494; font-style: italic;">&lt;U(4)&gt;</span> <span style="color: #949494; font-style: italic;">&lt;U(24)&gt;</span> <span style="color: #949494; font-style: italic;">&lt;U(12)&gt;</span> <span style="color: #949494; font-style: italic;">&lt;U(72)&gt;</span></span></span>
<span><span class="co">#&gt;       <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> Narrabri   col01   row01  plot01</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> Narrabri   col01   row02  plot02</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> Narrabri   col01   row03  plot03</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> Narrabri   col02   row01  plot04</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> Narrabri   col02   row02  plot05</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> Narrabri   col02   row03  plot06</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> Narrabri   col03   row01  plot07</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> Narrabri   col03   row02  plot08</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> Narrabri   col03   row03  plot09</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> Narrabri   col04   row01  plot10</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">11</span> Narrabri   col04   row02  plot11</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">12</span> Narrabri   col04   row03  plot12</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">13</span> Narrabri   col05   row01  plot13</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">14</span> Narrabri   col05   row02  plot14</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">15</span> Narrabri   col05   row03  plot15</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">16</span> Narrabri   col06   row01  plot16</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">17</span> Narrabri   col06   row02  plot17</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">18</span> Narrabri   col06   row03  plot18</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">19</span> Horsham    col07   row04  plot19</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">20</span> Horsham    col07   row05  plot20</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 52 more rows</span></span></span></code></pre></div>
<p>You may realise that the labels for the rows do not start with “row1” for Horsham. The default output displays distinct labels for the unit levels that are actually distinct. This safeguards for instances where the relationship between factors is lost, and the analyst will have to guess what units may be nested or crossed. However, nested labels may still be desirable. You can select the factors to show the nested labels by naming these factors as arguments for the <code>label_nested</code> in <code>serve_table</code> (below shows the nesting labels for <code>row</code> and <code>col</code> – notice <code>plot</code> still shows the distinct labels).</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/serve_table.html">serve_table</a></span><span class="op">(</span><span class="va">complex</span>, label_nested <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">row</span>, <span class="va">col</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># </span><span style="color: #949494; font-weight: bold;">Complex structure</span> </span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># An edibble: 72 x 4</span></span></span>
<span><span class="co">#&gt;        site     col     row    plot</span></span>
<span><span class="co">#&gt;      <span style="color: #949494; font-style: italic;">&lt;U(4)&gt;</span> <span style="color: #949494; font-style: italic;">&lt;U(24)&gt;</span> <span style="color: #949494; font-style: italic;">&lt;U(12)&gt;</span> <span style="color: #949494; font-style: italic;">&lt;U(72)&gt;</span></span></span>
<span><span class="co">#&gt;       <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> Narrabri    col1    row1  plot01</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> Narrabri    col1    row2  plot02</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> Narrabri    col1    row3  plot03</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> Narrabri    col2    row1  plot04</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> Narrabri    col2    row2  plot05</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> Narrabri    col2    row3  plot06</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> Narrabri    col3    row1  plot07</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> Narrabri    col3    row2  plot08</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> Narrabri    col3    row3  plot09</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> Narrabri    col4    row1  plot10</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">11</span> Narrabri    col4    row2  plot11</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">12</span> Narrabri    col4    row3  plot12</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">13</span> Narrabri    col5    row1  plot13</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">14</span> Narrabri    col5    row2  plot14</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">15</span> Narrabri    col5    row3  plot15</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">16</span> Narrabri    col6    row1  plot16</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">17</span> Narrabri    col6    row2  plot17</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">18</span> Narrabri    col6    row3  plot18</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">19</span> Horsham     col1    row1  plot19</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">20</span> Horsham     col1    row2  plot20</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 52 more rows</span></span></span></code></pre></div>
<p>You later find that the dimensions of Narrabri and Roseworthy are larger. The experimenter tells you that there are in fact 9 columns available, and therefore 27 plots at Narrabri and Roseworthy. The number of columns can be modified according to each site, as below, where <code>col</code> is defined to have 9 levels at Narrabri and Roseworthy but 6 levels elsewhere.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">complexd</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/design.html">design</a></span><span class="op">(</span><span class="st">"Complex structure with different dimensions"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="../reference/set_units.html">set_units</a></span><span class="op">(</span>site <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Narrabri"</span>, <span class="st">"Horsham"</span>, <span class="st">"Parkes"</span>, <span class="st">"Roseworthy"</span><span class="op">)</span>,</span>
<span>             col <span class="op">=</span> <span class="fu"><a href="../reference/nested_in.html">nested_in</a></span><span class="op">(</span><span class="va">site</span>, </span>
<span>                      <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Narrabri"</span>, <span class="st">"Roseworthy"</span><span class="op">)</span> <span class="op">~</span> <span class="fl">9</span>,</span>
<span>                                                <span class="va">.</span> <span class="op">~</span> <span class="fl">6</span><span class="op">)</span>,</span>
<span>             row <span class="op">=</span> <span class="fu"><a href="../reference/nested_in.html">nested_in</a></span><span class="op">(</span><span class="va">site</span>, <span class="fl">3</span><span class="op">)</span>,</span>
<span>            plot <span class="op">=</span> <span class="fu"><a href="../reference/nested_in.html">nested_in</a></span><span class="op">(</span><span class="va">site</span>, <span class="fu"><a href="../reference/crossed_by.html">crossed_by</a></span><span class="op">(</span><span class="va">row</span>, <span class="va">col</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> </span>
<span></span>
<span><span class="va">complextab</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/serve_table.html">serve_table</a></span><span class="op">(</span><span class="va">complexd</span>, label_nested <span class="op">=</span> <span class="fu">everything</span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">complextab</span><span class="op">$</span><span class="va">site</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;    Horsham   Narrabri     Parkes Roseworthy </span></span>
<span><span class="co">#&gt;         18         27         18         27</span></span></code></pre></div>
<p>You can see above that there are indeed nine additional plots at Narrabri and Roseworthy. The argument for <code>label_nested</code> supports <code>tidyselect</code> approach for selecting factors.</p>
</div>
</div>
<div class="section level2">
<h2 id="sec-trt">Treatments<a class="anchor" aria-label="anchor" href="#sec-trt"></a>
</h2>
<p>Defining treatment factors is only necessary when designing a comparative experiment. The treatment factors can be set similar to the unit factors using <code>set_trts</code>. Below, we define an experiment with three treatment factors: variety (a or b), fertilizer (A or B), and amount of fertilizer (0.5, 1, or 2 t/ha).</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">factrt</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/design.html">design</a></span><span class="op">(</span><span class="st">"Factorial treatment"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="../reference/set_trts.html">set_trts</a></span><span class="op">(</span>variety <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"a"</span>, <span class="st">"b"</span><span class="op">)</span>,</span>
<span>           fertilizer <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"A"</span>, <span class="st">"B"</span><span class="op">)</span>,</span>
<span>           amount <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.5</span>, <span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span> </span></code></pre></div>
<p>The links between treatment factors need not be explicitly defined. It is automatically assumed that treatment factors are crossed (i.e., the resulting treatment is the combination of all treatment factors) with the full set of treatments shown via <code>trts_table</code>. For the above experiment, there are a total of 12 treatments with the levels given below.</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/trts_table.html">trts_table</a></span><span class="op">(</span><span class="va">factrt</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 12 × 3</span></span></span>
<span><span class="co">#&gt;    variety fertilizer amount</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> a       A             0.5</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> b       A             0.5</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> a       B             0.5</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> b       B             0.5</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> a       A             1  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> b       A             1  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> a       B             1  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> b       B             1  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> a       A             2  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> b       A             2  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">11</span> a       B             2  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">12</span> b       B             2</span></span></code></pre></div>
<p>The <code>factrt</code> cannot be served as an <code>edbl_table</code> object, since there are no units defined in this experiment and how these treatments are administered to the units.</p>
<div class="section level3">
<h3 id="sec-conditioned">Conditional treatments<a class="anchor" aria-label="anchor" href="#sec-conditioned"></a>
</h3>
<p>In some experiments, certain treatment factors are dependent on another treatment factor. A common example is when the dose or amount of a treatment factor is also a treatment factor. In the field trial example, we can have a case in which we administer no fertilizer to a plot. In this case, there is no point crossing with different <code>amount</code>s; in fact, the amount of no fertilizer should always be 0. We can specify this conditional treatment structure by describing this relationship using the helper function, <code>conditioned_on</code>, as below. The “.” in the LHS is a shorthand to mean all levels, except for those specified previously.</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">factrtc</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/design.html">design</a></span><span class="op">(</span><span class="st">"Factorial treatment with control"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="../reference/set_trts.html">set_trts</a></span><span class="op">(</span>variety <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"a"</span>, <span class="st">"b"</span><span class="op">)</span>,</span>
<span>           fertilizer <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"none"</span>, <span class="st">"A"</span>, <span class="st">"B"</span><span class="op">)</span>,</span>
<span>           amount <span class="op">=</span> <span class="fu"><a href="../reference/nested_in.html">conditioned_on</a></span><span class="op">(</span><span class="va">fertilizer</span>,</span>
<span>                                    <span class="st">"none"</span> <span class="op">~</span> <span class="fl">0</span>,</span>
<span>                                         <span class="va">.</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.5</span>, <span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>We can see below that the variety is crossed with other factors, as expected, but the amount is conditional on the fertilizer.</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/trts_table.html">trts_table</a></span><span class="op">(</span><span class="va">factrtc</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 14 × 3</span></span></span>
<span><span class="co">#&gt;    variety fertilizer amount</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> a       none          0  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> b       none          0  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> a       A             0.5</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> b       A             0.5</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> a       A             1  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> b       A             1  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> a       A             2  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> b       A             2  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> a       B             0.5</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> b       B             0.5</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">11</span> a       B             1  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">12</span> b       B             1  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">13</span> a       B             2  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">14</span> b       B             2</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="links">Links<a class="anchor" aria-label="anchor" href="#links"></a>
</h2>
<p>In <code>edibble</code>, each experimental factor is encoded as a node in the factor graph along with its levels as nodes in the level graph. The edges (or links) can only be specified after the nodes are created. The links define the relationship between the experimental factors and the direction determining the hierarchy with the nodes. Often, these links are implicitly understood and not explicitly encoded, thus making it difficult to utilise the information downstream. By encoding the links, we can derive information and validate processes downstream.</p>
<p>Users specify these links using functions that are semantically aligned with thinking in the construction of an experimental design. There are three high-level approaches to defining these links as summarised in the table below:</p>
<table class="table">
<colgroup>
<col width="20%">
<col width="20%">
<col width="20%">
<col width="40%">
</colgroup>
<thead><tr class="header">
<th>Approach</th>
<th>Functions</th>
<th>Modifies</th>
<th>Purpose</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>Within role group</td>
<td>
<code>nested_in</code>, <code>crossed_by</code>, <code>conditioned_on</code>
</td>
<td>Both factor and level graphs</td>
<td>Links between the nodes of the same role only.</td>
</tr>
<tr class="even">
<td>Allotment</td>
<td>
<code>allot_trts</code>, <code>allot_units</code>, <code>set_rcrds</code>, <code>set_rcrds_of</code>
</td>
<td>Factor graph only</td>
<td>Capture high-level links that are typically apriori known by the user.</td>
</tr>
<tr class="odd">
<td>Assignment</td>
<td>
<code>assign_trts</code>, <code>assign_units</code>
</td>
<td>Level graph only</td>
<td>Determine links between nodes, often algorithmically.</td>
</tr>
</tbody>
</table>
<div class="section level3">
<h3 id="sec-within">Within role group<a class="anchor" aria-label="anchor" href="#sec-within"></a>
</h3>
<p>The helper functions, <code>nested_in</code> and <code>crossed_by</code> construct nested and crossed units, respectively (shown above). The helper function, <code>conditioned_on</code> (demonstrated above) constructs a conditional treatment structure. These helper functions concurrently draw links between the relevant nodes in both factor and level graphs. These links would be apriori known to the user and these helper functions are just semantically designed to make it easier for the user to specify the links between nodes. These helper functions only construct links between nodes belonging to the same role (i.e., unit or treatment).</p>
</div>
<div class="section level3">
<h3 id="sec-allot">Allotment<a class="anchor" aria-label="anchor" href="#sec-allot"></a>
</h3>
<p>Links specified using an allotment approach designate high-level links between factors. In other words, this approach only draws edges between nodes in the factor graph, and almost always, these edges are intentionally formed by the user. The purpose of this approach is to capture a user’s high-level intention or knowledge.</p>
<p>For demonstration, we leverage the previously defined unit (<code>complexd</code>) and treatment structures (<code>factrtc</code>). These structures can be combined to obtain the combined design object as below.</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">complexd</span> <span class="op">+</span> <span class="va">factrtc</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB; font-style: italic;">Complex structure with different dimensions</span></span></span>
<span><span class="co">#&gt; ├─<span style="color: #BBBB00; background-color: #000000;">site</span> <span style="color: #555555;">(4 levels)</span></span></span>
<span><span class="co">#&gt; │ ├─<span style="color: #BBBB00; background-color: #000000;">col</span> <span style="color: #555555;">(30 levels)</span></span></span>
<span><span class="co">#&gt; │ │ └─<span style="color: #BBBB00; background-color: #000000;">plot</span> <span style="color: #555555;">(90 levels)</span></span></span>
<span><span class="co">#&gt; │ ├─<span style="color: #BBBB00; background-color: #000000;">row</span> <span style="color: #555555;">(12 levels)</span></span></span>
<span><span class="co">#&gt; │ │ └─<span style="color: #BBBB00; background-color: #000000;">plot</span> <span style="color: #555555;">(90 levels)</span></span></span>
<span><span class="co">#&gt; │ └─<span style="color: #BBBB00; background-color: #000000;">plot</span> <span style="color: #555555;">(90 levels)</span></span></span>
<span><span class="co">#&gt; ├─<span style="color: #0000BB;">variety</span> <span style="color: #555555;">(2 levels)</span></span></span>
<span><span class="co">#&gt; ├─<span style="color: #0000BB;">fertilizer</span> <span style="color: #555555;">(3 levels)</span></span></span>
<span><span class="co">#&gt; └─<span style="color: #0000BB;">amount</span> <span style="color: #555555;">(4 levels)</span></span></span></code></pre></div>
<p>The above design object does not describe the links between the treatments and units. The function <code>allot_trts</code> ascribes the links between treatments to units in the factor graph.</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">alloted1</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="va">complexd</span> <span class="op">+</span> <span class="va">factrtc</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="../reference/allot_trts.html">allot_trts</a></span><span class="op">(</span>    <span class="va">fertilizer</span> <span class="op">~</span> <span class="va">row</span>,</span>
<span>             <span class="va">amount</span><span class="op">:</span><span class="va">variety</span> <span class="op">~</span> <span class="va">plot</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="sec-assign">Assignment<a class="anchor" aria-label="anchor" href="#sec-assign"></a>
</h3>
<p>The <code>assign_trts</code> (often algorithmically) draw links between the treatment and unit nodes in the level graph (conditioned on the existing links in the factor graph).</p>
<p>There are five in-built assignment algorithms: “systematic-fastest” (synonym for “systematic”), “systematic-random-fastest” (synonym for “systematic-random”), “systematic-slowest”, “systematic-random-slowest”, and “random”. The variation in systematic assignment results in repeated ordering with respect to the unit order, without regard to any unit structure. When the number of units is not divisible by the total number of treatments, the earlier treatment levels would have an extra replicate. The “systematic-random-fastest” and “systematic-random-slowest” are systematic variants that ensure equal chances for all treatment levels to obtain an extra replicate by randomising the order of treatment levels before the systematic allocation of treatment to units proceeds. The “fastest” and “slowest” variants determine if treatment levels are fast or slow in varying across order of the unit (slow varying meaning that the same treatment levels will be closer together in unit order, whereas fast varying means the same treatment levels are spread out in unit order).</p>
<p>Building on the previously defined structure and allotment, we define an algorithm to assign links between unit and treatment levels using the function <code>assign_trts</code>. Below, we use a systematic ordering for the first allotment (fertilizer to row) then a random ordering for the second allotment (interaction of amount and variety to plot). An optional seed number is provided to ensure the generated design could be reproduced.</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">design1</span> <span class="op">&lt;-</span> <span class="va">alloted1</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="../reference/assign_fcts.html">assign_trts</a></span><span class="op">(</span>order <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"systematic"</span>, <span class="st">"random"</span><span class="op">)</span>,</span>
<span>              seed <span class="op">=</span> <span class="fl">2023</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="../reference/serve_table.html">serve_table</a></span><span class="op">(</span>label_nested <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">row</span>, <span class="va">col</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>While allotment (high-level allocation) and assignment (actual allocation) are distinguished in the system to provide flexibility to the user for defining these processes separately, it is likely that many users would concurrently define these processes. The <code>allot_table</code> function offers a shorthand that combines the call to <code>allot_trts</code>, <code>assign_trts</code>, and <code>serve_table</code> into one call.</p>
<p>To illustrate the difference when treatment interaction is alloted to a unit (like the second allotment in <code>allotment1</code>), below, we have a different allotment where the amount of fertilizer and variety are allotted to plot in a separate allotment. A separate allotment can be assigned using different algorithms and is considered independent of other allotments (unless the treatment factor is conditional on another treatment factor).</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">design2</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="va">complexd</span> <span class="op">+</span> <span class="va">factrtc</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="../reference/allot_table.html">allot_table</a></span><span class="op">(</span><span class="va">fertilizer</span> <span class="op">~</span> <span class="va">row</span>,</span>
<span>                  <span class="va">amount</span> <span class="op">~</span> <span class="va">plot</span>,</span>
<span>                 <span class="va">variety</span> <span class="op">~</span> <span class="va">plot</span>, </span>
<span>              order <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"systematic"</span>, <span class="st">"random"</span>, <span class="st">"random"</span><span class="op">)</span>,</span>
<span>              label_nested <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">row</span>, <span class="va">col</span><span class="op">)</span>,</span>
<span>              seed <span class="op">=</span> <span class="fl">2023</span><span class="op">)</span></span></code></pre></div>
<p>The assignment algorithms in the system use the default constraint, which takes the nesting structure defined in the unit structure (i.e. row is nested in site and plot is crossed by row and column and nested in site). This constraint is used to define the nature of “random” assignment. For example, in the code below, we relax this constraint such that the <code>plot</code> factor is constrained within a <code>row</code> (default was <code>row</code>, <code>col</code> and <code>site</code>), which in turn is contained within the <code>site</code>. This difference in constraints results in a different path in the algorithm (as shown in the overview in <span class="citation">@fig-assign-alg</span>).</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">design3</span> <span class="op">&lt;-</span> <span class="va">alloted1</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="../reference/assign_fcts.html">assign_trts</a></span><span class="op">(</span>order <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"systematic"</span>, <span class="st">"random"</span><span class="op">)</span>,</span>
<span>              seed <span class="op">=</span> <span class="fl">2023</span>, </span>
<span>              constrain <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>row <span class="op">=</span> <span class="st">"site"</span>, plot <span class="op">=</span> <span class="st">"row"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="../reference/serve_table.html">serve_table</a></span><span class="op">(</span>label_nested <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">row</span>, <span class="va">col</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>The above three different designs (<code>design1</code>, <code>design2</code> and <code>design3</code>) share the same unit and treatment structure, but the allotment and/or assignment algorithm differed. One result of this is that the treatment replications, differ across the generated designs with the most ideal distribution seen in <code>design3</code> (if all fertilizer and amount combinations are of equal interest and fertilizer allocation is restricted to the row; arguably, it is better to remove the latter constraint, if practically feasible, so the units with the control treatment can be assigned for other treatment levels to obtain a more even distribution). The difference in <code>design1</code> and <code>design2</code> is that the amount and variety were allocated as an interaction in the former but independently in the latter. The latter process does not ensure near-equal replication of the treatment levels, so it is not surprising that <code>design2</code> has the least uniform treatment distribution.</p>
<p>Finding or creating the most appropriate assignment algorithm is one of the challenging tasks in the whole workflow. The default algorithm is unlikely to be optimal for the given structure, and the user is encouraged to modify this step to suit their own design.</p>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Emi Tanaka.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
