---
title: "Output configurations in edibble"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Output configurations in edibble}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r save-options, include = FALSE}
old_opts <- options()
```


```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  cache = FALSE,
  cache.path = "cache/"
)

# as seen for cli vignette
# Turn on ANSI colors
options(cli.num_colors = 256L)
options(asciicast_knitr_svg = TRUE)
asciicast::init_knitr_engine(
  startup = quote({
      library(edibble)
      set.seed(1231) 
      
      rcbd <- start_design(name = "RCBD") %>% 
              set_units(block = c("B1", "B2"),
                        unit = nested_in(block, 6)) %>% 
        set_trts(trt = LETTERS[1:4])

    }),
  echo = TRUE,
  echo_input = FALSE)
```


```{r setup}
library(edibble)
```

When you construct an experimental design, there are many intermediate steps along the way before you are ready to serve your design. edibble stores these intermediate constructs as an *edibble design* (`EddibbleDesign`) which you can visualise in a number of ways. 

```{r}
set.seed(1231) 

new_rcbd <- function() {
  start_design(name = "RCBD") %>%
  set_units(block = c("B1", "B2"),
            unit = nested_in(block, 6)) %>%
  set_trts(trt = LETTERS[1:4]) %>%
  allot_trts(~unit) %>%
  assign_trts("random")
}

rcbd <- new_rcbd()

class(rcbd)
```

An `edbl_design` contains a graph and table. The default print out is the same as `edbl_graph`. 


## Print for `edbl_graph`

If you print an `edbl_graph` object, it will show you a tree structure with a high-level overview of the design. Below is a print out of a design. The output form isn't really made for HTML and for complex reason color is lost for HTML (for the same reason as tibble).


The print out in terminal will look like below depending on your IDE theme. You can see that the color of the nodes are dependant on which type of variable it is and also shows you how many levels each variable has.


```{asciicast rcbd, out.width = "100%"}
rcbd
```

### Formatting print for `edbl_graph`

If you don't like the default choices, then you can easily customise the look by specifying the function of how to decorate the strings to options. Below I'm making use of functions in the cli package which wraps the string around in some styling.  

```{asciicast rcbd2, out.width = "100%"}
options(edibble.tree.decorate.trts = cli::bg_cyan,
        edibble.tree.decorate.units = function(x) cli::bg_yellow(glue::glue("<{x}>")),
        edibble.tree.decorate.resp = cli::col_yellow,
        edibble.tree.decorate.levels = function(x) cli::style_inverse(glue::glue("({x})")),
        edibble.tree.decorate.main = cli::style_underline)

rcbd
```


Instead of overwriting the options each time, you can set your `.Rprofile` so that when you load R, it will load the options in your profile. You can easily open `.Rprofile` with `usethis::edit_r_profile()`. I normally don't recommend to do this as it makes your output non-reproducible by others but the print output is made more for interactive use rather than reports so it doesn't matter much in this case. 



## Print for `edbl_table`

When you `serve_table` to signal that you want the table, the default view for `edbl_design` changes to the print out for `edbl_table`. 

```{asciicast redefine, out.width = "100%", echo = 9}
new_rcbd <- function() {
  start_design(name = "RCBD") %>%
  set_units(block = c("B1", "B2"),
            unit = nested_in(block, 6)) %>%
  set_trts(trt = LETTERS[1:4]) %>%
  allot_trts(~unit) %>%
  assign_trts("random")
}
serve_table(new_rcbd())
```

```{asciicast opt3, out.width = "100%", echo = 9:10}
new_rcbd <- function() {
  start_design(name = "RCBD") %>%
  set_units(block = c("B1", "B2"),
            unit = nested_in(block, 6)) %>%
  set_trts(trt = LETTERS[1:4]) %>%
  allot_trts(~unit) %>%
  assign_trts("random")
}
options(edibble.levels.label.leading_zero = TRUE)
serve_table(new_rcbd())
```

```{asciicast opt4, out.width = "100%", echo = 9:11}
new_rcbd <- function() {
  start_design(name = "RCBD") %>%
  set_units(block = c("B1", "B2"),
            unit = nested_in(block, 6)) %>%
  set_trts(trt = LETTERS[1:4]) %>%
  allot_trts(~unit) %>%
  assign_trts("random")
}
options(edibble.levels.label.leading_zero = TRUE,
        edibble.levels.label.min_ndigits = 5)
serve_table(new_rcbd())
```


```{r restore-options, include = FALSE}
options(old_opts)
```
